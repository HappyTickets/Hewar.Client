<div class="container">
  <p-table [value]="priceOffers" dataKey="id" stripedRows [paginator]="true" [rows]="10" [globalFilterFields]="['company.name']" selectionMode="single" #dt [rowsPerPageOptions]="[5, 10, 20]" [tableStyle]="{ 'min-width': '50rem'}">
    <ng-template #caption>
      <p-iconfield iconPosition="left">
        <p-inputicon><i class="pi pi-search"></i></p-inputicon>
        <input pInputText type="text" [(ngModel)]="searchTerm" (input)="dt.filterGlobal(searchTerm, 'contains')" placeholder="Global Search"/>
      </p-iconfield>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th></th>
        <th pSortableColumn="facilityName" style="width:25%">Facility Name <p-sortIcon field="facility.name"></p-sortIcon></th>
        <th pSortableColumn="facility.requestStatus" style="width:25%"> Status <p-sortIcon field="facility.requestStatus"></p-sortIcon></th>
        <th style="width:50%">Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-service let-expanded="expanded">
      <tr>
        <td>
          <p-button type="button" [pRowToggler]="service" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"/>
        </td>
        <td>{{ service.facilityName }}</td>
        <td>{{ 'enums.request-status.'+ service.offerStatus | translate }}</td>
        <td>
          <p-button class="m-1" label="Accept" [disabled]="service.offerStatus !== 1" (click)="acceptOffer(service.id)"/>
          <p-button class="m-1" label="Reject" [disabled]="service.offerStatus !== 1" (click)="rejectOffer(service.id)" [disabled]="service.offerStatus !== 1"/>
          <p-button class="m-1" label="Hide" (click)="hideOffer(service.id)"/>
          <p-button class="m-1" label="Detials"/>
          <p-button class="m-1" (click)="openChat()" label="Chat"/>
        </td>
      </tr>
    </ng-template>

    <!-- Expanded Row Content -->
    <ng-template pTemplate="rowexpansion" let-service>
      <tr>
        <td colspan="5">
          <h2>Services</h2>
          <p-table [value]="service.services" dataKey="id">
            <ng-template pTemplate="header">
              <tr>
                <th style="width:20%">ID</th>
                <th style="width:20%">Shift</th>
                <th style="width:20%">Quantity</th>
                <th style="width:20%">Daily Cost</th>
                <th style="width:20%">Monthly Cost</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-service>
              <tr>
                <td>{{ service.serviceId }}</td>
                <td>{{ 'enums.shift-type.' + service.shiftType | translate }}</td>
                <td>{{ service.quantity }}</td>
                <td>{{ service.dailyCostPerUnit }}</td>
                <td>{{ service.monthlyCostPerUnit }}</td>
              </tr>
            </ng-template>
          </p-table>
          <div class="flex justify-content-between">
            <div>Total Daily Cost: <strong>{{getTotalDailyCost(service.services)}}</strong></div>
            <div>Total Monthly Cost: <strong>{{getTotalMonthlyCost(service.services)}}</strong></div>
          </div>
          @if (service.otherServices.length > 0) {
            <h2>Other Services</h2>
            <p-table [value]="service.otherServices" dataKey="id">
              <ng-template pTemplate="header">
                <tr>
                  <th style="width:20%">Name</th>
                  <th style="width:20%">Shift</th>
                  <th style="width:20%">Quantity</th>
                  <th style="width:20%">Daily Cost</th>
                  <th style="width:20%">Monthly Cost</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-service>
                <tr>
                  <td>{{ service.name }}</td>
                  <td>{{ 'enums.shift-type.' + service.shiftType | translate }}</td>
                  <td>{{ service.quantity }}</td>
                  <td>{{ service.dailyCostPerUnit }}</td>
                  <td>{{ service.monthlyCostPerUnit }}</td>
                </tr>
              </ng-template>
            </p-table>
            <div class="flex justify-content-between">
              <div>Total Daily Cost: <strong>{{getTotalDailyCost(service.otherServices)}}</strong></div>
              <div>Total Monthly Cost: <strong>{{getTotalMonthlyCost(service.otherServices)}}</strong></div>
            </div>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
